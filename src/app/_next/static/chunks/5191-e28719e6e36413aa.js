"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5191],{75191:function(e,t,a){a.d(t,{s$:function(){return E},$Z:function(){return _.RepeatButton},P4:function(){return I.ShuffleButton},WP:function(){return n.SonataControls},ps:function(){return w},RN:function(){return C},B5:function(){return m}});var n=a(78457);a(18143),a(80128);var i=a(24244),r=a(42288),o=a(84338),s=a(62434),c=a(87181),l=a(30742),u=a(31841),d=a(38360),v=a(33589),h=a(8957),y=a(63394);let m=e=>{var t,a,n;switch(e.data.type){case u.A4.Generative:{let a=e.data.meta,n=(0,y.Us)(null==a?void 0:a.derivedColors);return(0,r.pj)({id:String(a.id),coverUri:a.imageUrl,title:null!==(t=a.title)&&void 0!==t?t:"",isAvailable:!0,isRemoved:!1,averageColor:n})}case l.RX.Unloaded:return null;default:{let t=e.data.meta,i=null===(a=t.artists)||void 0===a?void 0:a.map(v.d),o=null===(n=t.albums)||void 0===n?void 0:n.map(d.N);return(0,r.pj)({...(0,h.Ni)(t),artists:i,albums:o})}}},f=r.V5.model("UnloadedEntityMeta",{id:r.V5.union(r.V5.number,r.V5.string),albumId:r.V5.maybe(r.V5.union(r.V5.number,r.V5.string))}),g=r.V5.model("UnloadedEntityData",{meta:f,type:r.V5.literal(l.RX.Unloaded)});var p=a(21585),b=a(94342);let E=h.yp.props({artists:r.V5.array(v.Go),albums:r.V5.array(d.KX),chart:r.V5.maybe(b.BH)}).views(e=>({get idWithContext(){return e.albumId?"".concat(e.id,":").concat(e.albumId):e.id},get artistsNames(){var t;return null===(t=e.artists)||void 0===t?void 0:t.map(e=>e.name).join(", ")},get mainAlbum(){var a,n;return null!==(n=null===(a=e.albums)||void 0===a?void 0:a[0])&&void 0!==n?n:null},get index(){var i,r,o;return null!==(o=null===(r=e.albums[0])||void 0===r?void 0:null===(i=r.trackPosition)||void 0===i?void 0:i.index)&&void 0!==o?o:null},get isPodcast(){var s;return e.isTrackPodcast||(null===(s=this.mainAlbum)||void 0===s?void 0:s.isPodcast)},get isAudiobook(){return e.type===p.Vc.AUDIOBOOK},get isNonMusic(){return this.isPodcast||this.isAudiobook}})),w=r.V5.model("SonataState",{contextType:r.V5.maybeNull(r.V5.enumeration(Object.values(o.Ak))),contextId:r.V5.maybeNull(r.V5.string),entityMeta:r.V5.maybeNull(E),unloadedEntitiesData:r.V5.maybe(r.V5.array(g)),status:r.V5.enumeration(Object.values(l.Xz)),canMoveForward:r.V5.boolean,canMoveBackward:r.V5.boolean,canSpeed:r.V5.boolean,repeatMode:r.V5.enumeration(Object.values(c.zq)),canChangeRepeatMode:r.V5.boolean,volume:r.V5.maybe(r.V5.number),speed:r.V5.maybe(r.V5.number),canShuffle:r.V5.boolean,shuffle:r.V5.boolean,currentlyPlayingTrackIndex:r.V5.maybe(r.V5.number),quality:r.V5.enumeration(Object.values(s.nJ))}).views(e=>({get unloadedEntitiesDataFromModels(){return(0,i.ZN)(e.unloadedEntitiesData)},get isGenerativeContext(){return e.contextType===o.Ak.Generative}})).actions(e=>({setContextId:t=>{e.contextId=String(t)},setContextType:t=>{e.contextType=t},setEntityMeta:t=>{t&&t.data.meta&&(e.entityMeta=m(t))},setUnloadedEntitiesData:t=>{t&&(e.unloadedEntitiesData=(0,r.pj)(t))},resetUnloadedEntitiesData:()=>{e.unloadedEntitiesData=void 0},setStatus:t=>{e.status=t},setCanMoveForward:t=>{e.canMoveForward=t},setCanMoveBackward:t=>{e.canMoveBackward=t},setVolume:t=>{e.volume=t},setCanSpeed:t=>{e.canSpeed=t},setSpeed:t=>{e.speed=t},setRepeatMode:t=>{e.repeatMode=t},setCanChangeRepeatMode:t=>{e.canChangeRepeatMode=t},setCanShuffle:t=>{e.canShuffle=t},setShuffle:t=>{e.shuffle=t},setCurrentlyPlayingTrackIndex:t=>{e.currentlyPlayingTrackIndex=t},setQuality:t=>{e.quality=t}})),C=(e,t)=>({type:l.RX.Unloaded,meta:{id:e,albumId:t}});var I=a(94975),_=a(99331)},62434:function(e,t,a){a.d(t,{Tb:function(){return v},nJ:function(){return r},sd:function(){return w},$J:function(){return I},Ez:function(){return V}});var n,i,r,o,s=a(8655),c=a(21585);async function l(e){let{secretKey:t,data:a}=e,n=new TextEncoder,i=n.encode(t);return crypto.subtle.importKey("raw",i,{name:"HMAC",hash:{name:"SHA-256"}},!0,["sign","verify"]).then(async e=>{let t=n.encode(a);return crypto.subtle.sign("HMAC",e,t).then(e=>btoa(String.fromCharCode(...new Uint8Array(e))).slice(0,-1))})}function u(){return Math.floor(Date.now()/1e3)}var d=a(37810);class v extends d.y{constructor(e,{code:t="E_DOWNLOADINFO_MEDIA_PROVIDER",...a}={}){super(e,{code:t,...a}),(0,s._)(this,"name","DownloadInfoMediaProviderException"),Object.setPrototypeOf(this,v.prototype)}}let h={lossless:[{codec:c.V9.FLAC,bitrateInKbps:0}],hq:[{codec:c.V9.MP3,bitrateInKbps:320}],nq:[{codec:c.V9.AAC,bitrateInKbps:128},{codec:c.V9.MP3,bitrateInKbps:192}],lq:[{codec:c.V9.AAC,bitrateInKbps:128},{codec:c.V9.MP3,bitrateInKbps:192}],preview:[{codec:c.V9.MP3,bitrateInKbps:128}],smart_preview:[{codec:c.V9.MP3,bitrateInKbps:128}]};class y{getMediaSource(e){return new Promise((t,a)=>{let{entity:{data:{meta:{id:n}}}}=e,i=u();l({secretKey:this.secretKey,data:"".concat(i).concat(n)}).then(e=>{this.resource.getStorageData({trackId:String(n),sign:e,tsInSeconds:i,canUseStreaming:!1,direct:!1,requireMp3Link:!1,isAliceRequester:!1,preview:this.mediaConfigController.qualityConfig.preview.value}).then(e=>{let i=function(e,t){if(t.preview.value&&e[0])return e[0];let a=e.find(e=>h.lossless.find(t=>e.codec===t.codec)),n=e.find(e=>h.hq.find(t=>e.codec===t.codec&&e.bitrateInKbps===t.bitrateInKbps)),i=e.find(e=>h.nq.find(t=>e.codec===t.codec&&e.bitrateInKbps===t.bitrateInKbps));return t.lossless.value&&a?a:t.hq.value&&n?n:(t.lq.value||t.nq.value)&&i?i:null}(e,this.mediaConfigController.qualityConfig);null!==i?this.resource.getSrcData({storageUrl:i.downloadInfoUrl}).then(e=>{try{let a=function(e){let{srcData:t,secretKey:a,trackId:n}=e,i=function(e,t){let a,n,i,r,o,s,c,l,u;let d=String.fromCharCode;function v(e,t){return e<<t|e>>>32-t}function h(e,t){let a,n,i,r,o;return(i=2147483648&e,r=2147483648&t,a=1073741824&e,n=1073741824&t,o=(1073741823&e)+(1073741823&t),a&n)?2147483648^o^i^r:a|n?1073741824&o?3221225472^o^i^r:1073741824^o^i^r:o^i^r}function y(e,t,a,n,i,r,o){return e=h(e,h(h(t&a|~t&n,i),o)),h(v(e,r),t)}function m(e,t,a,n,i,r,o){return e=h(e,h(h(t&n|a&~n,i),o)),h(v(e,r),t)}function f(e,t,a,n,i,r,o){return e=h(e,h(h(t^a^n,i),o)),h(v(e,r),t)}function g(e,t,a,n,i,r,o){return e=h(e,h(h(a^(t|~n),i),o)),h(v(e,r),t)}function p(e){let t="",a="",n,i;for(i=0;i<=3;i++)n=e>>>8*i&255,t+=(a="0".concat(n.toString(16))).substr(a.length-2,2);return t}let b=[];for(a=0,b=function(e){let t;let a=e.length,n=a+8,i=((n-n%64)/64+1)*16,r=Array(i-1),o=0,s=0;for(;s<a;)t=(s-s%4)/4,o=s%4*8,r[t]=r[t]|e.charCodeAt(s)<<o,s++;return t=(s-s%4)/4,o=s%4*8,r[t]=r[t]|128<<o,r[i-2]=a<<3,r[i-1]=a>>>29,r}(e=function(e){e=t+e.replace(/\r\n/g,"\n");let a="";for(let t=0;t<e.length;t++){let n=e.charCodeAt(t);n<128?a+=d(n):n>127&&n<2048?a+=d(n>>6|192)+d(63&n|128):a+=d(n>>12|224)+d(n>>6&63|128)+d(63&n|128)}return a}(e)),s=1732584193,c=4023233417,l=2562383102,u=271733878;a<b.length;a+=16)n=s,i=c,r=l,o=u,s=y(s,c,l,u,b[a+0],7,3614090360),u=y(u,s,c,l,b[a+1],12,3905402710),l=y(l,u,s,c,b[a+2],17,606105819),c=y(c,l,u,s,b[a+3],22,3250441966),s=y(s,c,l,u,b[a+4],7,4118548399),u=y(u,s,c,l,b[a+5],12,1200080426),l=y(l,u,s,c,b[a+6],17,2821735955),c=y(c,l,u,s,b[a+7],22,4249261313),s=y(s,c,l,u,b[a+8],7,1770035416),u=y(u,s,c,l,b[a+9],12,2336552879),l=y(l,u,s,c,b[a+10],17,4294925233),c=y(c,l,u,s,b[a+11],22,2304563134),s=y(s,c,l,u,b[a+12],7,1804603682),u=y(u,s,c,l,b[a+13],12,4254626195),l=y(l,u,s,c,b[a+14],17,2792965006),c=y(c,l,u,s,b[a+15],22,1236535329),s=m(s,c,l,u,b[a+1],5,4129170786),u=m(u,s,c,l,b[a+6],9,3225465664),l=m(l,u,s,c,b[a+11],14,643717713),c=m(c,l,u,s,b[a+0],20,3921069994),s=m(s,c,l,u,b[a+5],5,3593408605),u=m(u,s,c,l,b[a+10],9,38016083),l=m(l,u,s,c,b[a+15],14,3634488961),c=m(c,l,u,s,b[a+4],20,3889429448),s=m(s,c,l,u,b[a+9],5,568446438),u=m(u,s,c,l,b[a+14],9,3275163606),l=m(l,u,s,c,b[a+3],14,4107603335),c=m(c,l,u,s,b[a+8],20,1163531501),s=m(s,c,l,u,b[a+13],5,2850285829),u=m(u,s,c,l,b[a+2],9,4243563512),l=m(l,u,s,c,b[a+7],14,1735328473),c=m(c,l,u,s,b[a+12],20,2368359562),s=f(s,c,l,u,b[a+5],4,4294588738),u=f(u,s,c,l,b[a+8],11,2272392833),l=f(l,u,s,c,b[a+11],16,1839030562),c=f(c,l,u,s,b[a+14],23,4259657740),s=f(s,c,l,u,b[a+1],4,2763975236),u=f(u,s,c,l,b[a+4],11,1272893353),l=f(l,u,s,c,b[a+7],16,4139469664),c=f(c,l,u,s,b[a+10],23,3200236656),s=f(s,c,l,u,b[a+13],4,681279174),u=f(u,s,c,l,b[a+0],11,3936430074),l=f(l,u,s,c,b[a+3],16,3572445317),c=f(c,l,u,s,b[a+6],23,76029189),s=f(s,c,l,u,b[a+9],4,3654602809),u=f(u,s,c,l,b[a+12],11,3873151461),l=f(l,u,s,c,b[a+15],16,530742520),c=f(c,l,u,s,b[a+2],23,3299628645),s=g(s,c,l,u,b[a+0],6,4096336452),u=g(u,s,c,l,b[a+7],10,1126891415),l=g(l,u,s,c,b[a+14],15,2878612391),c=g(c,l,u,s,b[a+5],21,4237533241),s=g(s,c,l,u,b[a+12],6,1700485571),u=g(u,s,c,l,b[a+3],10,2399980690),l=g(l,u,s,c,b[a+10],15,4293915773),c=g(c,l,u,s,b[a+1],21,2240044497),s=g(s,c,l,u,b[a+8],6,1873313359),u=g(u,s,c,l,b[a+15],10,4264355552),l=g(l,u,s,c,b[a+6],15,2734768916),c=g(c,l,u,s,b[a+13],21,1309151649),s=g(s,c,l,u,b[a+4],6,4149444226),u=g(u,s,c,l,b[a+11],10,3174756917),l=g(l,u,s,c,b[a+2],15,718787259),c=g(c,l,u,s,b[a+9],21,3951481745),s=h(s,n),c=h(c,i),l=h(l,r),u=h(u,o);return(p(s)+p(c)+p(l)+p(u)).toLowerCase()}(t.path.substr(1)+t.s,a),r="/get-mp3/".concat(i,"/").concat(t.ts).concat(t.path,"?track-id=").concat(n,"&play=false");return"https://".concat(t.host).concat(r)}({trackId:n,srcData:e,secretKey:this.secretKey});t(a)}catch(t){let e=t;t instanceof Error&&(e={name:t.name,message:t.message,stack:t.stack,cause:t.cause}),a(new v("Failed to create src link",{code:"E_CREATE_SRC_LINK",cause:e,data:{trackId:n}}))}}).catch(e=>{a(new v("Failed to get src data",{code:"E_GET_SRC_DATA",cause:e,data:{trackId:n}}))}):a(new v("No storage url for entity",{code:"E_NO_STORAGE_URL"}))}).catch(e=>{a(new v("Failed to get storage data",{code:"E_GET_STORAGE_DATA",cause:e,data:{trackId:n}}))})}).catch(e=>{let t=e;e instanceof Error&&(t={name:e.name,message:e.message,stack:e.stack,cause:e.cause}),a(new v("Failed to create sign",{code:"E_CREATE_SIGN",cause:t,data:{trackId:n}}))})})}constructor(e){(0,s._)(this,"secretKey",void 0),(0,s._)(this,"resource",void 0),(0,s._)(this,"mediaConfigController",void 0);let{httpClient:t,resourceConfig:a,secretKey:n,mediaConfigController:i}=e;this.resource=new c.HZ(t,{params:a.params,gateway:a.gateway,overembed:a.overembed,externalDomain:a.externalDomain,retryPolicyConfig:a.retryPolicyConfig,timeouts:a.timeouts}),this.mediaConfigController=i,this.secretKey=n}}var m=a(31841);(n=r||(r={})).HQ_PLUS="hqPlus",n.HQ="hq",n.NQ="nq",n.LQ="lq",n.PREVIEW="preview";class f extends d.y{constructor(e,{code:t="E_GET_FILE_INFO_MEDIA_PROVIDER",...a}={}){super(e,{code:t,...a}),(0,s._)(this,"name","GetFileInfoMediaProviderException"),Object.setPrototypeOf(this,f.prototype)}}let g=[c.V9.FLAC,c.V9.AAC,c.V9.HEAAC,c.V9.MP3];class p{getMediaSource(e){let t=u(),a=function(e,t,a){if((0,m.YM)(t))return c.nJ.SMART_PREVIEW;let n=a?c.nJ.LQ:c.nJ.NQ;switch(e){case r.HQ_PLUS:n=c.nJ.LOSSLESS;break;case r.HQ:n=a?c.nJ.NQ:c.nJ.HQ;break;case r.NQ:case r.LQ:n=a?c.nJ.LQ:c.nJ.NQ;break;case r.PREVIEW:n=c.nJ.PREVIEW}return n}(this.mediaConfigController.quality.value,e.entity,this.variables.useNewCorrespondenceBetweenQualityParams),n=g.join(""),i="".concat(t).concat(e.entity.data.meta.id).concat(a).concat(n).concat(this.transport);return new Promise((r,o)=>{l({data:i,secretKey:this.secretKey}).then(i=>this.resource.getFileInfo({tsInSeconds:t,trackId:e.entity.data.meta.id,quality:a,codecs:g,transports:[this.transport],sign:i}).then(t=>{var a;if(!(null===(a=t.downloadInfo.urls)||void 0===a?void 0:a[0]))throw Error("An empty array of URLs has been received");e.entity.mediaSource=t,r(t.downloadInfo.urls[0])}).catch(t=>{let i=t;t instanceof Error&&(i={name:t.name,message:t.message,stack:t.stack,cause:t.cause}),o(new f("An empty array of URLs has been received",{code:"E_EMPTY_URLS",cause:i,data:{trackId:e.entity.data.meta.id,quality:a,codecs:n}}))})).catch(t=>{let i=t;t instanceof Error&&(i={name:t.name,message:t.message,stack:t.stack,cause:t.cause}),o(new f("Failed to create sign",{code:"E_CREATE_SIGN",cause:i,data:{trackId:e.entity.data.meta.id,quality:a,codecs:n}}))})})}constructor(e){(0,s._)(this,"secretKey",void 0),(0,s._)(this,"resource",void 0),(0,s._)(this,"mediaConfigController",void 0),(0,s._)(this,"transport",void 0),(0,s._)(this,"variables",void 0);let{httpClient:t,resourceConfig:a,secretKey:n,mediaConfigController:i,transport:r,variables:o}=e;this.resource=new c.dF(t,{params:a.params,gateway:a.gateway}),this.secretKey=n,this.mediaConfigController=i,this.transport=r,this.variables=o}}class b extends d.y{constructor(e,{code:t="E_YAMUSIC_ENTITY_PROVIDER",...a}={}){super(e,{code:t,...a}),(0,s._)(this,"name","YaMusicEntityProviderException"),Object.setPrototypeOf(this,b.prototype)}}var E=a(84338);class w{async loadEntities(e){let t=e.map(e=>{let{context:t,entity:a}=e;return(0,E.m3)(t)?"".concat(a.data.meta.id,":").concat(t.data.meta.id):(0,E.KT)(t)&&"albumId"in a.data.meta&&a.data.meta.albumId?"".concat(a.data.meta.id,":").concat(a.data.meta.albumId):a.data.meta.id});return this.resource.getTracksMeta({trackIds:t,withProgress:!0}).then(e=>{let t=[];for(let a of e)t.push({type:m.A4.Unknown,meta:a});return t}).catch(e=>{throw new b("Failed to get entities meta",{cause:e})})}constructor(e){(0,s._)(this,"resource",void 0);let{httpClient:t,config:a}=e;this.resource=new c.HZ(t,{params:a.params,gateway:a.gateway,retryPolicyConfig:a.retryPolicyConfig,timeouts:a.timeouts})}}var C=a(80789);class I{setQuality(e){switch(e){case r.HQ_PLUS:this.qualityConfig.lossless.value=!0,this.qualityConfig.hq.value=!0,this.qualityConfig.nq.value=!0,this.qualityConfig.lq.value=!0,this.qualityConfig.preview.value=!1,this.quality.value=r.HQ_PLUS;break;case r.HQ:this.qualityConfig.lossless.value=!1,this.qualityConfig.hq.value=!0,this.qualityConfig.nq.value=!0,this.qualityConfig.lq.value=!0,this.qualityConfig.preview.value=!1,this.quality.value=r.HQ;break;case r.NQ:case r.LQ:this.qualityConfig.lossless.value=!1,this.qualityConfig.hq.value=!1,this.qualityConfig.nq.value=!0,this.qualityConfig.lq.value=!0,this.qualityConfig.preview.value=!1,this.quality.value=r.NQ;break;case r.PREVIEW:this.qualityConfig.lossless.value=!1,this.qualityConfig.hq.value=!1,this.qualityConfig.nq.value=!1,this.qualityConfig.lq.value=!1,this.qualityConfig.preview.value=!0,this.quality.value=r.PREVIEW}}constructor(e){(0,s._)(this,"qualityConfig",{lossless:new C.wi(!1),hq:new C.wi(!0),nq:new C.wi(!0),lq:new C.wi(!0),preview:new C.wi(!0),smart_preview:new C.wi(!1)}),(0,s._)(this,"quality",new C.wi(r.HQ)),this.setQuality(e)}}(i=o||(o={})).DOWNLOAD_INFO_PROVIDER="downloadInfoProvider",i.GET_FILE_INFO_PROVIDER="getFileInfoProvider";class _ extends d.y{constructor(e,{code:t="E_GENERATIVE_MEDIA_PROVIDER",...a}={}){super(e,{code:t,...a}),(0,s._)(this,"name","GenerativeMediaProviderException"),Object.setPrototypeOf(this,_.prototype)}}class P{async getMediaSource(e){return(0,m.OX)(e.entity)?this.getGenerativeSrc(e.entity.data):new Promise((e,t)=>{t(new _("Provided entity is not generative entity",{code:"E_NOT_GENERATIVE_NETITY"}))})}async getGenerativeSrc(e){return new Promise((t,a)=>{var n;(null===(n=e.meta.stream)||void 0===n?void 0:n.url)?t(e.meta.stream.url):a(new _("Failed to create generative src link",{code:"E_CREATE_GENERATIVE_SRC_LINK"}))})}}class V{async getMediaSource(e){return(0,m.OX)(e.entity)?this.generativeProvider.getMediaSource(e):(this.variables.switchToStrmWithoutEncrypt?this.getFileInfoProvider:this.downloadInfoProvider).getMediaSource(e)}constructor(e){(0,s._)(this,"generativeProvider",new P),(0,s._)(this,"downloadInfoProvider",void 0),(0,s._)(this,"getFileInfoProvider",void 0),(0,s._)(this,"variables",void 0),this.variables=e.variables||{},this.downloadInfoProvider=new y(e.downloadInfoProviderParams),this.getFileInfoProvider=new p(e.getFileInfoProviderParams)}}}}]);