(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1533],{61533:function(e,a,t){"use strict";t.d(a,{i$:function(){return i.PlaylistPage},nb:function(){return h}});var i=t(42488);t(63407);var l=t(24244),r=t(42288),s=t(10542),n=t(31579),o=t(23472),d=t(63394);let u=(e,a)=>a.map(a=>{let t=e.find(e=>String(e.id)===a);return(null==t?void 0:t.albumId)?"".concat(a,":").concat(t.albumId):a}),c=(e,a)=>a.map(a=>{let t=e[a];return(null==t?void 0:t.albumId)?"".concat(t.id,":").concat(t.albumId):String(null==t?void 0:t.id)}),m=(e,a)=>{let{startIndex:t,endIndex:i}=a,l=[];for(let a=t;a<=i;a++){var r,s;((null===(r=e[a])||void 0===r?void 0:r.loadingState)===d.Gu.IDLE||(null===(s=e[a])||void 0===s?void 0:s.loadingState)===d.Gu.REJECT)&&l.push(a)}return l};var g=t(75191);let v=e=>e.map(e=>(0,g.RN)(e.id,e.albumId||void 0)),y=r.V5.model("PlaylistItem",{id:r.V5.union(r.V5.string,r.V5.number),albumId:r.V5.maybeNull(r.V5.union(r.V5.string,r.V5.number)),key:r.V5.string,data:r.V5.maybeNull(o.le),loadingState:r.V5.enumeration(Object.values(d.Gu))}),p=r.V5.model("PlaylistSearchItems",{playlistTrackIds:r.V5.maybeNull(r.V5.array(r.V5.string)),suggestedTrackIds:r.V5.maybeNull(r.V5.array(r.V5.string)),additionTrackInProggress:r.V5.maybeNull(r.V5.string),tracks:r.V5.maybeNull(r.V5.array(o.le))}).views(e=>({get suggestedTracks(){var a;return null===(a=e.suggestedTrackIds)||void 0===a?void 0:a.map(a=>{var t;return(null===(t=e.tracks)||void 0===t?void 0:t.find(e=>e.id===a))||null})},get playlistTracks(){let a=[...e.playlistTrackIds||[]];return e.additionTrackInProggress&&a.unshift(e.additionTrackInProggress),null==a?void 0:a.map(a=>{var t;return(null===(t=e.tracks)||void 0===t?void 0:t.find(e=>{var t;return((null===(t=e.mainAlbum)||void 0===t?void 0:t.id)&&a.includes(":")?"".concat(e.id,":").concat(e.mainAlbum.id):e.id)===a}))||null})}})).actions(e=>({setAdditionTrackAnimation(a){e.additionTrackInProggress=a},replaceAdditionTrackInProggress(){if(e.additionTrackInProggress){var a,t;null===(a=e.playlistTrackIds)||void 0===a||a.unshift(e.additionTrackInProggress),e.suggestedTrackIds=(0,r.pj)(null===(t=e.suggestedTrackIds)||void 0===t?void 0:t.filter(a=>a!==e.additionTrackInProggress)),e.additionTrackInProggress=null}},resetAdditionTrackAnimation(){e.additionTrackInProggress=null}})),h=r.V5.model("PlaylistPage",{meta:r.V5.maybeNull(n.Nn),items:r.V5.array(y),errorStatusCode:r.V5.maybeNull(r.V5.number),loadingState:r.V5.enumeration(Object.values(d.Gu)),similarPlaylists:r.V5.array(n.d2),searchLoadingState:r.V5.enumeration(Object.values(d.Gu)),searchItems:p}).views(e=>({get isNotFound(){return e.loadingState===d.Gu.REJECT&&e.errorStatusCode===s.CN.NOT_FOUND},get isLoading(){return e.loadingState===d.Gu.PENDING||e.loadingState===d.Gu.IDLE},get isSearchLoading(){return e.searchLoadingState===d.Gu.PENDING||e.searchLoadingState===d.Gu.IDLE},get isDisabled(){var a;return e.loadingState===d.Gu.RESOLVE&&(0===e.items.length||!(null===(a=e.meta)||void 0===a?void 0:a.isAvailable))},get isRejected(){return e.loadingState===d.Gu.REJECT},get hasSimilarPlaylists(){return e.loadingState===d.Gu.IDLE||e.loadingState===d.Gu.PENDING||e.similarPlaylists.length>0},get isEmptyPlaylist(){return 0===e.items.length&&e.loadingState===d.Gu.RESOLVE},get contextMeta(){var t,i,l,n,o,u,c,m,g,v;return{isAvailable:null===(t=e.meta)||void 0===t?void 0:t.isAvailable,id:e.meta.id,uid:null===(i=e.meta)||void 0===i?void 0:i.uid,uuid:e.meta.uuid,kind:null===(l=e.meta)||void 0===l?void 0:l.kind,title:null===(n=e.meta)||void 0===n?void 0:n.title,coverUri:null===(o=e.meta)||void 0===o?void 0:o.coverUri,likesCount:null===(u=e.meta)||void 0===u?void 0:u.likesCount,averageColor:null===(c=e.meta)||void 0===c?void 0:c.averageColor,owner:null===(m=e.meta)||void 0===m?void 0:m.owner,description:null===(g=e.meta)||void 0===g?void 0:g.description,modified:null===(v=e.meta)||void 0===v?void 0:v.modified}},get isDragAndDropEnabled(){var y;if(!(0,r.fh)(e))return!1;let{experiments:a}=(0,r.yj)(e);return!!((null===(y=e.meta)||void 0===y?void 0:y.canUserChange)&&e.items.length>1&&a.checkExperiment(d.pe.WebNextPlaylistDnD,"on"))},get itemsKeys(){return e.items.map(e=>e.key)}})).actions(e=>{let a={getTracksByRange:(0,r.ls)(function*(a){var t,i;let{startIndex:l,endIndex:s}=a,{tracksResource:n,modelActionsLogger:u}=(0,r.dU)(e);if(!(null===(t=e.meta)||void 0===t?void 0:t.uid)||!(null===(i=e.meta)||void 0===i?void 0:i.kind))return null;l=Math.max(0,l),s=Math.min(s,e.items.length);let g=m(e.items,{startIndex:l,endIndex:s});try{let a=c(e.items,g);if(!a.length)return null;g.forEach(a=>{let t=e.items[a];t&&(t.loadingState=d.Gu.PENDING)});let t=yield n.getTracksMeta({trackIds:a,withProgress:!0});g.forEach((a,i)=>{let l=null==t?void 0:t[i];if(e.items[a]&&l){var r,s;e.items[a]={id:l.id,albumId:(null===(s=l.albums)||void 0===s?void 0:null===(r=s[0])||void 0===r?void 0:r.id)||null,key:"".concat(l.id,"-").concat(a),data:(0,o.Vt)(l),loadingState:d.Gu.RESOLVE}}})}catch(a){u.error(a),g.forEach(a=>{let t=e.items[a];t&&(t.loadingState=d.Gu.REJECT)})}return null}),getSearchTracksMeta:(0,r.ls)(function*(){let{tracksResource:a,modelActionsLogger:t}=(0,r.dU)(e),i=[...e.searchItems.playlistTrackIds||[]].concat(e.searchItems.suggestedTrackIds||[]);try{let t=yield a.getTracksMeta({trackIds:i,removeDuplicates:!0});e.searchItems.tracks=(0,r.pj)(null==t?void 0:t.map(e=>(0,o.Vt)(e))),e.searchLoadingState!==d.Gu.IDLE&&(e.searchLoadingState=d.Gu.RESOLVE)}catch(e){t.error(e)}return null}),updateData:(0,r.ls)(function*(t){var i;if((null==t?void 0:t.error)==="not-found")return e.errorStatusCode=s.CN.NOT_FOUND,e.loadingState=d.Gu.REJECT,null;e.similarPlaylists=(0,r.pj)(null===(i=t.similarPlaylists)||void 0===i?void 0:i.map(n.VB)),e.meta=(0,n.Q9)(t),e.items=(0,r.pj)(t.tracks.map((e,a)=>({id:String(e.id),albumId:e.albumId||null,key:"".concat(e.id,"-").concat(a),loadingState:d.Gu.IDLE})));let{sonataState:l}=(0,r.yj)(e);return l.setUnloadedEntitiesData(v(e.items)),yield a.getTracksByRange({startIndex:0,endIndex:10})}),getPlaylistByUserIdAndKind:(0,r.ls)(function*(t){let{userId:i,playlistKind:l,resumeStream:n=!1,trackMetaType:o}=t,{usersResource:u,modelActionsLogger:c}=(0,r.dU)(e);if(e.loadingState!==d.Gu.PENDING)try{e.loadingState=d.Gu.PENDING;let t=yield u.getPlaylistWithTracksIds({userId:i,playlistKind:l,resumeStream:n,trackMetaType:o});if("string"!=typeof t.playlistUuid){e.errorStatusCode=s.CN.NOT_FOUND,e.loadingState=d.Gu.REJECT;return}yield a.updateData(t),e.loadingState=d.Gu.RESOLVE}catch(a){c.error(a),a instanceof s.du&&(a.statusCode===s.CN.NOT_FOUND||a.statusCode===s.CN.BAD_REQUEST)&&(e.errorStatusCode=s.CN.NOT_FOUND),e.loadingState=d.Gu.REJECT}}),getSearchTracks:(0,r.ls)(function*(t){let{uid:i,kind:l,part:n=""}=t,{searchPlaylistResource:o,modelActionsLogger:c}=(0,r.dU)(e);if(e.searchLoadingState!==d.Gu.PENDING&&n.length)try{e.searchLoadingState=d.Gu.PENDING;let{playlistTrackIds:t=[],suggestedTrackIds:s=[]}=yield o.getTrackIds({uid:i,kind:l,part:n}),c=u(e.items,t);e.searchItems.playlistTrackIds=(0,r.pj)(c),e.searchItems.suggestedTrackIds=(0,r.pj)(s),a.getSearchTracksMeta()}catch(a){c.error(a),a instanceof s.du&&(a.statusCode===s.CN.NOT_FOUND||a.statusCode===s.CN.BAD_REQUEST)&&(e.errorStatusCode=s.CN.NOT_FOUND),e.searchLoadingState!==d.Gu.IDLE&&(e.searchLoadingState=d.Gu.REJECT)}}),getPlaylistByUuid:(0,r.ls)(function*(t){let{playlistUuid:i,richTracks:l=!1,resumeStream:n=!1}=t,{playlistResource:o,modelActionsLogger:u}=(0,r.dU)(e);if(e.loadingState!==d.Gu.PENDING)try{e.loadingState=d.Gu.PENDING;let t=yield o.getPlaylist({playlistUuid:i,resumeStream:n,richTracks:l});yield a.updateData(t),e.loadingState!==d.Gu.IDLE&&(e.loadingState=d.Gu.RESOLVE)}catch(a){u.error(a),a instanceof s.du&&(a.statusCode===s.CN.NOT_FOUND||a.statusCode===s.CN.BAD_REQUEST)&&(e.errorStatusCode=s.CN.NOT_FOUND),e.loadingState!==d.Gu.IDLE&&(e.loadingState=d.Gu.REJECT)}}),moveTrack(a,t){let i=(0,l.ZN)(e.items[a]);if(!(a<0)&&!(t<0)&&!(a>=e.items.length)&&!(t>=e.items.length)&&i&&(e.items.splice(a,1),e.items.splice(t,0,i),(0,r.fh)(e))){let{sonataState:a}=(0,r.yj)(e);a.setUnloadedEntitiesData(v(e.items))}},removeTracksFromItems(a,t){if(e.items.splice(a,t),(0,r.fh)(e)){let{sonataState:a}=(0,r.yj)(e);a.setUnloadedEntitiesData(v(e.items))}},resetSearch(){e.searchItems.playlistTrackIds=null,e.searchItems.suggestedTrackIds=null,e.searchItems.additionTrackInProggress=null,e.searchItems.tracks=null,e.searchLoadingState=d.Gu.IDLE},reset(){let{sonataState:t}=(0,r.yj)(e);t.resetUnloadedEntitiesData(),e.meta=null,e.loadingState=d.Gu.IDLE,e.items=(0,r.pj)([]),e.similarPlaylists=(0,r.pj)([]),e.errorStatusCode=null,a.resetSearch()},refresh(){var t,i;(null===(t=e.meta)||void 0===t?void 0:t.uuid)&&a.getPlaylistByUuid({playlistUuid:null===(i=e.meta)||void 0===i?void 0:i.uuid,resumeStream:!1})}};return a})},63407:function(e,a,t){"use strict";t.d(a,{PlaylistNotFoundPage:function(){return s}});var i=t(9753),l=t(9544),r=t(23948);let s=(0,l.Pi)(()=>(0,i.jsx)(r.T,{}))},42488:function(e,a,t){"use strict";t.d(a,{PlaylistPage:function(){return K}});var i=t(9753),l=t(60836),r=t(9544),s=t(74717),n=t(98639),o=t(80542),d=t(23881),u=t(70171),c=t(95772),m=t(98780),g=t(31014),v=t(54950),y=t(2570),p=t(31579),h=t(23472),P=t(12090),I=t(63394),k=t(67868),S=t(84338);let _=(e,a)=>{let t=e.id,i=e.albumId;return{contextData:{type:S.Ak.Various,meta:{id:i?"".concat(t,":").concat(i):t},from:a},queueParams:{index:0},loadContextMeta:!0}};var T=t(59048),N=t.n(T);let E=(0,r.Pi)(e=>{var a,t,r,s,d,u,c,S;let{autoFocus:T,onChange:E,className:D}=e,{formatMessage:C}=(0,o.Z)(),[f,x]=(0,n.useState)(""),{playlist:L}=(0,I.oR)(),b=null==L?void 0:L.searchItems,j=(0,h.Wc)(),A=(0,n.useRef)(0),G=(null===(a=L.meta)||void 0===a?void 0:a.isOwnPlaylist)?I.Rh.OWN_PLAYLISTS:I.Rh.PLAYLIST,R=(0,I.x5)({pageId:G,blockId:I.aU.FILTERED}),V=(0,I.x5)({pageId:G,blockId:I.aU.SUGGESTED}),[O,U]=(0,n.useState)(!1);(0,n.useEffect)(()=>()=>{window.clearTimeout(A.current),null==E||E(!1)},[E]);let B=(0,n.useMemo)(()=>(0,m.Z)(e=>{let a=e.trim();x(a),a&&(null==L?void 0:L.meta)&&(L.resetSearch(),L.getSearchTracks({uid:L.meta.uid,kind:L.meta.kind,part:a})),(!a||0===a.length)&&O&&(U(!1),L.refresh()),null==E||E(!!a.length)},100),[L,O,E]),w=(0,n.useCallback)(async e=>{if(L.meta){b.setAdditionTrackAnimation(e.id);let a=j({track:e,playlist:L.meta,withSuccessNotification:!1,withPageRefresh:!1}),t=new Promise(e=>{A.current=window.setTimeout(e,300)}),[i]=await Promise.all([a,t]);i===P.pX.OK?(b.replaceAdditionTrackInProggress(),U(!0)):b.resetAdditionTrackAnimation()}},[j,L.meta,b]),M=(0,n.useMemo)(()=>{var e;return L.isSearchLoading?(0,i.jsx)(k.DX,{isActive:!0,className:N().shimmerItem,variant:I.Lx.PLAYLIST}):null==b?void 0:null===(e=b.playlistTracks)||void 0===e?void 0:e.map(e=>e?(0,i.jsx)(h.O2,{className:(0,l.W)(N().track,{[N().appearingTrack]:e.id===b.additionTrackInProggress}),track:e,playContextParams:_(e,R)},e.id):null)},[L.isSearchLoading,null==b?void 0:b.playlistTracks,b.additionTrackInProggress,R]),F=(0,n.useMemo)(()=>{var e,a;return(null===(e=L.meta)||void 0===e?void 0:e.canUserChange)?L.isSearchLoading?(0,i.jsx)(k.DX,{isActive:!0,className:N().shimmerItem,variant:I.Lx.PLAYLIST}):null==b?void 0:null===(a=b.suggestedTracks)||void 0===a?void 0:a.map(e=>e?(0,i.jsx)(h.VZ,{track:e,className:(0,l.W)({[N().disappearingTrack]:e.id===b.additionTrackInProggress}),playContextParams:_(e,V),onClick:w},e.id):null):void 0},[null===(t=L.meta)||void 0===t?void 0:t.canUserChange,L.isSearchLoading,null==b?void 0:b.suggestedTracks,b.additionTrackInProggress,V,w]),W=(0,n.useMemo)(()=>{var e,a,t;let l=!(null==b?void 0:null===(e=b.suggestedTracks)||void 0===e?void 0:e.length)||!(null===(a=L.meta)||void 0===a?void 0:a.canUserChange);return(null==b?void 0:null===(t=b.playlistTrackIds)||void 0===t?void 0:t.length)||!l||L.isSearchLoading?null:(0,i.jsx)(p.vY,{className:N().emptyBlockContainer,isEmptySearch:!0})},[null==b?void 0:null===(r=b.playlistTrackIds)||void 0===r?void 0:r.length,null==b?void 0:null===(s=b.suggestedTracks)||void 0===s?void 0:s.length,null===(d=L.meta)||void 0===d?void 0:d.canUserChange,L.isSearchLoading]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(v.M,{className:(0,l.W)(N().root,D),autoFocus:T,initialValue:f,correctedValue:null,placeholder:C({id:"search.track-placeholder"}),onChange:B,resetButtonAriaLabel:C({id:"interface-actions.reset-search-input"}),onResetClick:L.resetSearch}),f&&(0,i.jsxs)("div",{className:N().content,children:[W,M,Number(null==b?void 0:null===(u=b.suggestedTracks)||void 0===u?void 0:u.length)>0&&(null===(c=L.meta)||void 0===c?void 0:c.canUserChange)&&(0,i.jsx)(y.Caption,{variant:"div",type:"text",size:"s",weight:"medium",className:(0,l.W)(N().catalog,{[N().catalog_withTracks]:null==b?void 0:null===(S=b.playlistTrackIds)||void 0===S?void 0:S.length}),children:(0,i.jsx)(g.Z,{id:"search.search-catalog"})},"search.search-catalog-caption"),F]})]})});var D=t(5293),C=t(23178),f=t.n(C),x=t(52674),L=t(20258),b=t.n(L);let j=(0,r.Pi)((0,n.forwardRef)((e,a)=>{var t;let{children:r,"data-index":s,...o}=e,{playlist:d}=(0,I.oR)(),{isDragging:u,listeners:c,setNodeRef:m,transform:g,transition:v,attributes:y}=(0,x.nB)({id:String(null===(t=d.items[s])||void 0===t?void 0:t.key)}),p=(0,n.useCallback)(e=>{m(e),"function"==typeof a&&a(e)},[a,m]),h={transition:v,"--translate-y":g?"".concat(Math.round(g.y),"px"):void 0};return(0,i.jsx)("div",{ref:p,"data-index":s,style:h,...o,className:b().root,children:(0,i.jsx)("div",{className:(0,l.W)(b().inner,{[b().dragging]:u}),...c,...y,children:r})})}));var A=t(98466),G=t(62115),R=t(773);let V=(e,a)=>{var t;let i=a-1;if(!e.items.length||i<0||i>e.items.length)return"";let l=e.items[i];return(null==l?void 0:null===(t=l.data)||void 0===t?void 0:t.title)||""},O=e=>{let{formatMessage:a}=(0,o.Z)();return{screenReaderInstructions:{draggable:a({id:"drag-and-drop.playlist-move-instructions"})},announcements:{onDragStart(t){let{active:i}=t;return a({id:"drag-and-drop.playlist-on-move-start"},{trackName:V(e,Number(i.id)),index:i.id})},onDragOver(t){let{active:i,over:l}=t,r=V(e,Number(i.id));return l?a({id:"drag-and-drop.playlist-on-move"},{trackName:r,index:l.id}):a({id:"drag-and-drop.playlist-on-move-fail"},{trackName:r})},onDragEnd(t){let{active:i,over:l}=t,r=V(e,Number(i.id));return l?a({id:"drag-and-drop.playlist-on-move-end-with-index"},{trackName:r,index:l.id}):a({id:"drag-and-drop.playlist-on-move-end"},{trackName:r})},onDragCancel:()=>a({id:"drag-and-drop.playlist-on-move-cancel"})}}},U=e=>{let{notify:a}=(0,I.d$)(),{formatMessage:t}=(0,o.Z)();return(0,n.useCallback)(async l=>{var r,s,n,o;let{from:d,to:u}=l;if(d<0||u<0||d>=e.items.length||u>=e.items.length)return;let c=String(null===(r=e.items[d])||void 0===r?void 0:r.id);if(!c)return;let m=(null===(s=e.items[d])||void 0===s?void 0:s.albumId)?Number(null===(n=e.items[d])||void 0===n?void 0:n.albumId):void 0;e.moveTrack(d,u);let g=await (null===(o=e.meta)||void 0===o?void 0:o.changePlaylist((0,P.PG)({operation:P.aL.MOVE,startPosition:d,endPosition:u,tracks:[{id:c,albumId:m}]})));g&&g===P.pX.OK||(g===P.pX.RELOAD?e.refresh():e.moveTrack(u,d),a((0,i.jsx)(k.Q,{error:t({id:"drag-and-drop.failed-to-move"})}),{containerId:I.W$.ERROR}))},[t,a,e])};var B=t(66034),w=t.n(B);let M=(0,r.Pi)(e=>{var a,t;let l,{index:r,className:s,isDragging:n,draggingClassName:o}=e,{playlist:d,experiments:u,sonataState:c}=(0,I.oR)(),m=u.checkExperiment(I.pe.WebNextPlaylistAddition,"on")&&(null===(a=d.meta)||void 0===a?void 0:a.isOwnPlaylist),g=(0,I.x5)({pageId:I.Rh.PLAYLIST,blockId:I.aU.PLAYLIST}),v=d.isDragAndDropEnabled,y=d.items[r];return d.isEmptyPlaylist&&m?(0,i.jsx)(p.vY,{className:w().emptyBlockContainer}):(l=y&&y.data&&d.meta?y.data.isTrackPodcast||(null===(t=y.data.mainAlbum)||void 0===t?void 0:t.isPodcast)?(0,i.jsx)(h.N6,{withPodcastName:!0,withDNDBlock:v,isDragging:n,track:y.data,draggingClassName:o,playContextParams:{contextData:{type:S.Ak.Playlist,meta:d.contextMeta,from:g},entitiesData:c.unloadedEntitiesDataFromModels,queueParams:{index:r},loadContextMeta:!0},className:s}):(0,i.jsx)(h.O2,{withDNDBlock:v,isDragging:n,track:y.data,draggingClassName:o,playContextParams:{contextData:{type:S.Ak.Playlist,meta:d.contextMeta,from:g},entitiesData:c.unloadedEntitiesDataFromModels,queueParams:{index:r},loadContextMeta:!0},className:s}):(0,i.jsx)(k.DX,{isActive:!0,className:w().shimmerItem,variant:I.Lx.PLAYLIST}),(0,i.jsx)(P.jK.Provider,{value:{playlist:d.meta,trackIndex:r},children:l}))});var F=t(74502),W=t.n(F);let Y=(0,r.Pi)(e=>{let{children:a,playlist:t}=e,{announcements:l,screenReaderInstructions:r}=O(t),s=U(t),o=(0,A.Dy)((0,A.VT)(A.MA,{activationConstraint:{distance:{y:1},tolerance:5}}),(0,A.VT)(A.LO,{activationConstraint:{delay:250,tolerance:5}}),(0,A.VT)(A.Lg,{coordinateGetter:x.is,keyboardCodes:{start:["Enter"],cancel:["Escape"],end:["Enter"]}})),[d,u]=(0,n.useState)(null),c=(0,n.useCallback)(e=>{let{active:a}=e;u(a.id)},[]),m=(0,n.useCallback)(e=>{let{active:a,over:i}=e;if(!a.id||!(null==i?void 0:i.id))return;let l=t.itemsKeys.indexOf(String(a.id)),r=t.itemsKeys.indexOf(String(i.id));Number.isInteger(l)&&Number.isInteger(r)&&s({from:l,to:r})},[s,t.itemsKeys]),g=(0,n.useCallback)(()=>{u(null)},[]),v=(0,n.useMemo)(()=>t.itemsKeys.indexOf(String(d)),[d,t.itemsKeys]);return t.isDragAndDropEnabled?(0,i.jsxs)(A.LB,{sensors:o,collisionDetection:A.pE,onDragStart:c,onDragEnd:m,onDragCancel:g,modifiers:[G.DL,G.F4],accessibility:{announcements:l,screenReaderInstructions:r},children:[(0,i.jsx)("div",{className:W().root,children:(0,i.jsx)(x.Fo,{items:t.itemsKeys,strategy:x.qw,children:a})}),(0,R.createPortal)((0,i.jsx)(A.y9,{dropAnimation:{duration:0},children:d?(0,i.jsx)("div",{className:W().draggableItemWrapper,children:(0,i.jsx)(M,{index:v,className:W().noHoverItem,isDragging:!0,draggingClassName:W().dots})}):null}),window.document.body)]}):a}),K=(0,r.Pi)(e=>{var a,t,r;let{userId:m,kind:g,playlistUuid:v}=e,y=(0,n.useRef)(0),{notify:h}=(0,I.d$)(),{playlist:P,experiments:S}=(0,I.oR)(),{formatMessage:_}=(0,o.Z)(),{ref:T,offsetY:N}=(0,u.e)(),[C,x]=(0,D.zU)(),L=(0,n.useMemo)(()=>{var e;return(0,I.XG)(null==P?void 0:null===(e=P.meta)||void 0===e?void 0:e.averageColor)},[null==P?void 0:null===(a=P.meta)||void 0===a?void 0:a.averageColor]),[b,A]=(0,D.at)(L,N),G=S.checkExperiment(I.pe.WebNextPlaylistAddition,"on")&&(null===(t=P.meta)||void 0===t?void 0:t.isOwnPlaylist),[R,V]=(0,n.useState)(!1),O=S.checkExperiment(I.pe.WebNextPlaylistAddition,"on");(0,n.useEffect)(()=>()=>{P.reset(),y.current=0},[P,v,m,g]),(0,n.useMemo)(()=>()=>{(P.isRejected||!P.meta&&!P.isLoading)&&y&&!(y.current>0)&&(h((0,i.jsx)(k.Q,{error:_({id:"playlist-errors.error-during-loading-playlist"})}),{containerId:I.W$.ERROR}),y.current++)},[P.isRejected,P.meta,P.isLoading,h,_])(),P.loadingState===I.Gu.IDLE&&("string"==typeof v?(0,n.use)(P.getPlaylistByUuid({playlistUuid:v,resumeStream:!1})):"string"==typeof m&&"string"==typeof g&&(0,n.use)(P.getPlaylistByUserIdAndKind({userId:m,playlistKind:Number(g),resumeStream:!1}))),(0,I.NO)(P.loadingState===I.Gu.RESOLVE),P.isNotFound&&(0,s.notFound)();let U=(0,n.useMemo)(()=>P.isLoading||!P.meta||P.isRejected?(0,i.jsx)(c.KC,{className:f().header}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(c.Vm,{playlist:P.meta,isDisabled:P.isDisabled,className:f().header,ref:T}),O&&(0,i.jsx)(E,{autoFocus:!P.items.length,onChange:V})]}),[P.isDisabled,P.isLoading,P.meta,P.isRejected,T,P.items,O]),B=(0,n.useMemo)(()=>({Header:()=>U,Item:P.isDragAndDropEnabled?j:void 0,Footer:()=>(0,i.jsxs)("div",{className:f().footerContainer,children:[(0,i.jsx)("div",{className:f().carouselBlocks,children:P.hasSimilarPlaylists&&(0,i.jsx)(I.J,{blockId:I.BE.PLAYLISTS_SIMILAR_PLAYLIST,blockType:I.BE.PLAYLISTS_SIMILAR_PLAYLIST,blockPosX:1,blockPosY:2,blockIdForFrom:I.BE.PLAYLISTS_SIMILAR_PLAYLIST,objectsCount:P.similarPlaylists.length,children:(0,i.jsx)(p.VD,{isShimmerVisible:P.isLoading,isShimmerActive:!0,className:f().carouselContainer,headerClassName:(0,l.W)(f().carouselBlockHeader,f().carouselBlock),containerClassName:f().carouselBlock,title:_({id:"entity-names.similar-playlists"}),playlists:P.similarPlaylists})})}),!(P.isEmptyPlaylist&&G)&&(0,i.jsx)(k.$_,{className:f().footer})]})}),[P.isDragAndDropEnabled,P.hasSimilarPlaylists,P.similarPlaylists,P.isLoading,P.isEmptyPlaylist,U,_,G]),w=(0,n.useCallback)(e=>{P.getTracksByRange(e)},[P]),F=(0,n.useCallback)(e=>{var a;return null===(a=P.items[e])||void 0===a?void 0:a.key},[P.items]),W=(0,n.useCallback)(e=>e,[]),K=P.items.length||(G?1:0);return(0,i.jsx)(I.Lh,{pageId:I.Rh.PLAYLIST,children:(0,i.jsxs)(D.I7,{scrollElement:C,children:[(0,i.jsx)(k.h4,{style:A}),(0,i.jsx)("div",{className:f().averageColorBackground,style:b}),(0,i.jsx)(Y,{playlist:P,children:(0,i.jsx)(k.Wv,{context:{listAriaLabel:_({id:"entity-names.playlist-tracks-list"},{playlistName:(null===(r=P.meta)||void 0===r?void 0:r.title)||""})},className:(0,l.W)(f().root,f().important),listClassName:f().content,customComponents:B,computeItemKey:P.isDragAndDropEnabled?F:W,totalCount:R?0:K,itemContentCallback:e=>(0,i.jsx)(M,{index:e}),onGetDataByRange:w,debounceDurationInMs:300,initialItemCount:P.items.length,handleRef:x,shouldTriggerRangeChangedOnTotalCountChange:!0,testId:d.Br.playlist.PLAYLIST_PAGE})})]})})})},23178:function(e){e.exports={root:"PlaylistPage_root__ajyaP",important:"PlaylistPage_important__1Xpl5",averageColorBackground:"PlaylistPage_averageColorBackground__3wEkw",header:"PlaylistPage_header__EdIoE",content:"PlaylistPage_content__T7zOm",footerContainer:"PlaylistPage_footerContainer__8uPBx",carouselBlock:"PlaylistPage_carouselBlock__lvaKg",carouselBlockHeader:"PlaylistPage_carouselBlockHeader__asTWy",carouselContainer:"PlaylistPage_carouselContainer__TfWiI",footer:"PlaylistPage_footer__ih_cJ"}},20258:function(e){e.exports={root:"PlaylistPageDnDItemWrapper_root__eBm1E",inner:"PlaylistPageDnDItemWrapper_inner__UXQZf",dragging:"PlaylistPageDnDItemWrapper_dragging__Pl94m",dragOverlay:"PlaylistPageDnDItemWrapper_dragOverlay__tWQut"}},74502:function(e){e.exports={root:"PlaylistPageDnDList_root__6Fryw",draggableItemWrapper:"PlaylistPageDnDList_draggableItemWrapper__vvEWL",dots:"PlaylistPageDnDList_dots__F4qh2",noHoverItem:"PlaylistPageDnDList_noHoverItem__dbPTH"}},66034:function(e){e.exports={emptyBlockContainer:"PlaylistPageItem_emptyBlockContainer__K5xRV",shimmerItem:"PlaylistPageItem_shimmerItem__s_fFo"}},59048:function(e){e.exports={root:"SearchPlaylistInput_root__o14iM",content:"SearchPlaylistInput_content__iDyfU",catalog:"SearchPlaylistInput_catalog__5r6Xm",catalog_withTracks:"SearchPlaylistInput_catalog_withTracks__B2ZYF",track:"SearchPlaylistInput_track__2TGLS",shimmerItem:"SearchPlaylistInput_shimmerItem__V0cOt",emptyBlockContainer:"SearchPlaylistInput_emptyBlockContainer__NSQKG",disappearingTrack:"SearchPlaylistInput_disappearingTrack__D6ja5",disappearing:"SearchPlaylistInput_disappearing__w48Cd",appearingTrack:"SearchPlaylistInput_appearingTrack__CYHzN",appearing:"SearchPlaylistInput_appearing__SafaE"}}}]);