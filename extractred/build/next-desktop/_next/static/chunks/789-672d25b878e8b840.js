"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[789],{30789:function(t,e,a){a.d(e,{i$:function(){return i.PlaylistPage},nb:function(){return I}});var i=a(49773);a(46924);var r=a(93043),l=a(96555),n=a(96431),s=a(20210),d=a(95539),o=a(84133);let u=(t,e)=>e.map(e=>{let a=t.find(t=>String(t.id)===e);return(null==a?void 0:a.albumId)?"".concat(e,":").concat(a.albumId):e}),c=(t,e)=>e.map(e=>{let a=t[e];return(null==a?void 0:a.albumId)?"".concat(a.id,":").concat(a.albumId):String(null==a?void 0:a.id)}),g=(t,e)=>{let{startIndex:a,endIndex:i}=e,r=[];for(let e=a;e<=i;e++){var l,n;((null===(l=t[e])||void 0===l?void 0:l.loadingState)===o.Gu.IDLE||(null===(n=t[e])||void 0===n?void 0:n.loadingState)===o.Gu.REJECT)&&r.push(e)}return r};var m=a(82436);let v=t=>t.map(t=>(0,m.RN)(t.id,t.albumId||void 0)),y=l.V5.model("PlaylistItem",{id:l.V5.union(l.V5.string,l.V5.number),albumId:l.V5.maybeNull(l.V5.union(l.V5.string,l.V5.number)),key:l.V5.string,data:l.V5.maybeNull(d.le),loadingState:l.V5.enumeration(Object.values(o.Gu))}),E=l.V5.model("PlaylistSearchItems",{playlistTrackIds:l.V5.maybeNull(l.V5.array(l.V5.string)),suggestedTrackIds:l.V5.maybeNull(l.V5.array(l.V5.string)),additionTrackInProggress:l.V5.maybeNull(l.V5.string),tracks:l.V5.maybeNull(l.V5.array(d.le))}).views(t=>({get suggestedTracks(){var e;return null===(e=t.suggestedTrackIds)||void 0===e?void 0:e.map(e=>{var a;return(null===(a=t.tracks)||void 0===a?void 0:a.find(t=>t.id===e))||null})},get playlistTracks(){let e=[...t.playlistTrackIds||[]];return t.additionTrackInProggress&&e.unshift(t.additionTrackInProggress),null==e?void 0:e.map(e=>{var a;return(null===(a=t.tracks)||void 0===a?void 0:a.find(t=>{var a;let i=(null===(a=t.mainAlbum)||void 0===a?void 0:a.id)&&e.includes(":")?"".concat(t.id,":").concat(t.mainAlbum.id):t.id;return i===e}))||null})}})).actions(t=>({setAdditionTrackAnimation(e){t.additionTrackInProggress=e},replaceAdditionTrackInProggress(){if(t.additionTrackInProggress){var e,a;null===(e=t.playlistTrackIds)||void 0===e||e.unshift(t.additionTrackInProggress),t.suggestedTrackIds=(0,l.pj)(null===(a=t.suggestedTrackIds)||void 0===a?void 0:a.filter(e=>e!==t.additionTrackInProggress)),t.additionTrackInProggress=null}},resetAdditionTrackAnimation(){t.additionTrackInProggress=null}})),I=l.V5.model("PlaylistPage",{meta:l.V5.maybeNull(s.Nn),items:l.V5.array(y),errorStatusCode:l.V5.maybeNull(l.V5.number),loadingState:l.V5.enumeration(Object.values(o.Gu)),similarPlaylists:l.V5.array(s.d2),searchLoadingState:l.V5.enumeration(Object.values(o.Gu)),searchItems:E}).views(t=>({get isNotFound(){return t.loadingState===o.Gu.REJECT&&t.errorStatusCode===n.CN.NOT_FOUND},get isLoading(){return t.loadingState===o.Gu.PENDING||t.loadingState===o.Gu.IDLE},get isSearchLoading(){return t.searchLoadingState===o.Gu.PENDING||t.searchLoadingState===o.Gu.IDLE},get isDisabled(){var e;return t.loadingState===o.Gu.RESOLVE&&(0===t.items.length||!(null===(e=t.meta)||void 0===e?void 0:e.isAvailable))},get isRejected(){return t.loadingState===o.Gu.REJECT},get hasSimilarPlaylists(){return t.loadingState===o.Gu.IDLE||t.loadingState===o.Gu.PENDING||t.similarPlaylists.length>0},get isEmptyPlaylist(){return 0===t.items.length&&t.loadingState===o.Gu.RESOLVE},get contextMeta(){var a,i,r,s,d,u,c,g,m,v;return{isAvailable:null===(a=t.meta)||void 0===a?void 0:a.isAvailable,id:t.meta.id,uid:null===(i=t.meta)||void 0===i?void 0:i.uid,uuid:t.meta.uuid,kind:null===(r=t.meta)||void 0===r?void 0:r.kind,title:null===(s=t.meta)||void 0===s?void 0:s.title,coverUri:null===(d=t.meta)||void 0===d?void 0:d.coverUri,likesCount:null===(u=t.meta)||void 0===u?void 0:u.likesCount,averageColor:null===(c=t.meta)||void 0===c?void 0:c.averageColor,owner:null===(g=t.meta)||void 0===g?void 0:g.owner,description:null===(m=t.meta)||void 0===m?void 0:m.description,modified:null===(v=t.meta)||void 0===v?void 0:v.modified}},get isDragAndDropEnabled(){var y;if(!(0,l.fh)(t))return!1;let{experiments:e}=(0,l.yj)(t);return!!((null===(y=t.meta)||void 0===y?void 0:y.canUserChange)&&t.items.length>1&&e.checkExperiment(o.pe.WebNextPlaylistDnD,"on"))},get itemsKeys(){return t.items.map(t=>t.key)}})).actions(t=>{let e={getTracksByRange:(0,l.ls)(function*(e){var a,i;let{startIndex:r,endIndex:s}=e,{tracksResource:u,logger:m}=(0,l.dU)(t);if(!(null===(a=t.meta)||void 0===a?void 0:a.uid)||!(null===(i=t.meta)||void 0===i?void 0:i.kind))return null;r=Math.max(0,r),s=Math.min(s,t.items.length);let v=g(t.items,{startIndex:r,endIndex:s});try{let e=c(t.items,v);if(!e.length)return null;v.forEach(e=>{let a=t.items[e];a&&(a.loadingState=o.Gu.PENDING)});let a=yield u.getTracksMeta({trackIds:e,withProgress:!0});v.forEach((e,i)=>{var r,l;let n=null==a?void 0:a[i];t.items[e]&&n&&(t.items[e]={id:n.id,albumId:(null===(l=n.albums)||void 0===l?void 0:null===(r=l[0])||void 0===r?void 0:r.id)||null,key:"".concat(n.id,"-").concat(e),data:(0,d.Vt)(n),loadingState:o.Gu.RESOLVE})})}catch(e){!(e instanceof n.eY)&&(e instanceof Error||"string"==typeof e)&&m.error(e),v.forEach(e=>{let a=t.items[e];a&&(a.loadingState=o.Gu.REJECT)})}return null}),getSearchTracksMeta:(0,l.ls)(function*(){let{tracksResource:e,logger:a}=(0,l.dU)(t),i=[...t.searchItems.playlistTrackIds||[]].concat(t.searchItems.suggestedTrackIds||[]);try{let a=yield e.getTracksMeta({trackIds:i,removeDuplicates:!0});t.searchItems.tracks=(0,l.pj)(null==a?void 0:a.map(d.Vt)),t.searchLoadingState!==o.Gu.IDLE&&(t.searchLoadingState=o.Gu.RESOLVE)}catch(t){!(t instanceof n.eY)&&(t instanceof Error||"string"==typeof t)&&a.error(t)}return null}),updateData:(0,l.ls)(function*(a){var i;if((null==a?void 0:a.error)==="not-found")return t.errorStatusCode=n.CN.NOT_FOUND,t.loadingState=o.Gu.REJECT,null;t.similarPlaylists=(0,l.pj)(null===(i=a.similarPlaylists)||void 0===i?void 0:i.map(s.VB)),t.meta=(0,s.Q9)(a),t.items=(0,l.pj)(a.tracks.map((t,e)=>({id:String(t.id),albumId:t.albumId||null,key:"".concat(t.id,"-").concat(e),loadingState:o.Gu.IDLE})));let{sonataState:r}=(0,l.yj)(t);return r.setUnloadedEntitiesData(v(t.items)),yield e.getTracksByRange({startIndex:0,endIndex:10})}),getPlaylistByUserIdAndKind:(0,l.ls)(function*(a){let{userId:i,playlistKind:r,resumeStream:s=!1,trackMetaType:d}=a,{usersResource:u,logger:c}=(0,l.dU)(t);if(t.loadingState!==o.Gu.PENDING)try{t.loadingState=o.Gu.PENDING;let a=yield u.getPlaylistWithTracksIds({userId:i,playlistKind:r,resumeStream:s,trackMetaType:d});if("string"!=typeof a.playlistUuid){t.errorStatusCode=n.CN.NOT_FOUND,t.loadingState=o.Gu.REJECT;return}yield e.updateData(a),t.loadingState=o.Gu.RESOLVE}catch(e){!(e instanceof n.eY)&&(e instanceof Error||"string"==typeof e)&&c.error(e),e instanceof n.du&&(e.statusCode===n.CN.NOT_FOUND||e.statusCode===n.CN.BAD_REQUEST)&&(t.errorStatusCode=n.CN.NOT_FOUND),t.loadingState=o.Gu.REJECT}}),getSearchTracks:(0,l.ls)(function*(a){let{uid:i,kind:r,part:s=""}=a,{searchPlaylistResource:d,logger:c}=(0,l.dU)(t);if(t.searchLoadingState!==o.Gu.PENDING&&s.length)try{t.searchLoadingState=o.Gu.PENDING;let{playlistTrackIds:a=[],suggestedTrackIds:n=[]}=yield d.getTrackIds({uid:i,kind:r,part:s}),c=u(t.items,a);t.searchItems.playlistTrackIds=(0,l.pj)(c),t.searchItems.suggestedTrackIds=(0,l.pj)(n),e.getSearchTracksMeta()}catch(e){!(e instanceof n.eY)&&(e instanceof Error||"string"==typeof e)&&c.error(e),e instanceof n.du&&(e.statusCode===n.CN.NOT_FOUND||e.statusCode===n.CN.BAD_REQUEST)&&(t.errorStatusCode=n.CN.NOT_FOUND),t.searchLoadingState!==o.Gu.IDLE&&(t.searchLoadingState=o.Gu.REJECT)}}),getPlaylistByUuid:(0,l.ls)(function*(a){let{playlistUuid:i,richTracks:r=!1,resumeStream:s=!1}=a,{playlistResource:d,logger:u}=(0,l.dU)(t);if(t.loadingState!==o.Gu.PENDING)try{t.loadingState=o.Gu.PENDING;let a=yield d.getPlaylist({playlistUuid:i,resumeStream:s,richTracks:r});yield e.updateData(a),t.loadingState!==o.Gu.IDLE&&(t.loadingState=o.Gu.RESOLVE)}catch(e){!(e instanceof n.eY)&&(e instanceof Error||"string"==typeof e)&&u.error(e),e instanceof n.du&&(e.statusCode===n.CN.NOT_FOUND||e.statusCode===n.CN.BAD_REQUEST)&&(t.errorStatusCode=n.CN.NOT_FOUND),t.loadingState!==o.Gu.IDLE&&(t.loadingState=o.Gu.REJECT)}}),moveTrack(e,a){let i=(0,r.ZN)(t.items[e]);if(!(e<0)&&!(a<0)&&!(e>=t.items.length)&&!(a>=t.items.length)&&i&&(t.items.splice(e,1),t.items.splice(a,0,i),(0,l.fh)(t))){let{sonataState:e}=(0,l.yj)(t);e.setUnloadedEntitiesData(v(t.items))}},removeTracksFromItems(e,a){t.items.splice(e,a)},resetSearch(){t.searchItems.playlistTrackIds=null,t.searchItems.suggestedTrackIds=null,t.searchItems.additionTrackInProggress=null,t.searchItems.tracks=null,t.searchLoadingState=o.Gu.IDLE},reset(){let{sonataState:a}=(0,l.yj)(t);a.resetUnloadedEntitiesData(),t.meta=null,t.loadingState=o.Gu.IDLE,t.items=(0,l.pj)([]),t.similarPlaylists=(0,l.pj)([]),t.errorStatusCode=null,e.resetSearch()},refresh(){var a,i;(null===(a=t.meta)||void 0===a?void 0:a.uuid)&&e.getPlaylistByUuid({playlistUuid:null===(i=t.meta)||void 0===i?void 0:i.uuid,resumeStream:!1})}};return e})}}]);