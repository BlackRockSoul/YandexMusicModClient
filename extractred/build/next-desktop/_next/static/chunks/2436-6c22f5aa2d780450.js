"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2436],{82436:function(e,t,a){a.d(t,{$Z:function(){return I.RepeatButton},P4:function(){return w.ShuffleButton},WP:function(){return n.SonataControls},ps:function(){return C},RN:function(){return b}});var n=a(2931);a(74758),a(34512);var r=a(93043),i=a(96555),o=a(71440),s=a(29765),l=a(94175),c=a(86502),u=a(84140),d=a(21774),y=a(81446),m=a(43310),h=a(84133);let v=e=>{var t,a,n;switch(e.data.type){case u.A4.Generative:{let a=e.data.meta,n=(0,h.Us)(null==a?void 0:a.derivedColors);return(0,i.pj)({id:String(a.id),coverUri:a.imageUrl,title:null!==(t=a.title)&&void 0!==t?t:"",isAvailable:!0,isRemoved:!1,averageColor:n})}case c.RX.Unloaded:return null;default:{let t=e.data.meta,r=null===(a=t.artists)||void 0===a?void 0:a.map(y.d),o=null===(n=t.albums)||void 0===n?void 0:n.map(d.N);return(0,i.pj)({...(0,m.Ni)(t),artists:r,albums:o})}}},f=i.V5.model("UnloadedEntityMeta",{id:i.V5.union(i.V5.number,i.V5.string),albumId:i.V5.maybe(i.V5.union(i.V5.number,i.V5.string))}),g=i.V5.model("UnloadedEntityData",{meta:f,type:i.V5.literal(c.RX.Unloaded)});var p=a(16121);let E=m.yp.props({artists:i.V5.array(y.Go),albums:i.V5.array(d.KX),chart:i.V5.maybe(p.BH)}).views(e=>({get idWithContext(){return e.albumId?"".concat(e.id,":").concat(e.albumId):e.id},get artistsNames(){var t;return null===(t=e.artists)||void 0===t?void 0:t.map(e=>e.name).join(", ")},get mainAlbum(){var a,n;return null!==(n=null===(a=e.albums)||void 0===a?void 0:a[0])&&void 0!==n?n:null},get index(){var r,i,o;return null!==(o=null===(i=e.albums[0])||void 0===i?void 0:null===(r=i.trackPosition)||void 0===r?void 0:r.index)&&void 0!==o?o:null}})),C=i.V5.model("SonataState",{contextType:i.V5.maybeNull(i.V5.enumeration(Object.values(o.Ak))),contextId:i.V5.maybeNull(i.V5.string),entityMeta:i.V5.maybeNull(E),unloadedEntitiesData:i.V5.maybe(i.V5.array(g)),status:i.V5.enumeration(Object.values(c.Xz)),canMoveForward:i.V5.boolean,canMoveBackward:i.V5.boolean,repeatMode:i.V5.enumeration(Object.values(l.zq)),canChangeRepeatMode:i.V5.boolean,volume:i.V5.maybe(i.V5.number),canShuffle:i.V5.boolean,shuffle:i.V5.boolean,currentlyPlayingTrackIndex:i.V5.maybe(i.V5.number),quality:i.V5.enumeration(Object.values(s.nJ))}).views(e=>({get unloadedEntitiesDataFromModels(){return(0,r.ZN)(e.unloadedEntitiesData)},get isGenerativeContext(){return e.contextType===o.Ak.Generative}})).actions(e=>({setContextId:t=>{e.contextId=String(t)},setContextType:t=>{e.contextType=t},setEntityMeta:t=>{t&&t.data.meta&&(e.entityMeta=v(t))},setUnloadedEntitiesData:t=>{t&&(e.unloadedEntitiesData=(0,i.pj)(t))},resetUnloadedEntitiesData:()=>{e.unloadedEntitiesData=void 0},setStatus:t=>{e.status=t},setCanMoveForward:t=>{e.canMoveForward=t},setCanMoveBackward:t=>{e.canMoveBackward=t},setVolume:t=>{e.volume=t},setRepeatMode:t=>{e.repeatMode=t},setCanChangeRepeatMode:t=>{e.canChangeRepeatMode=t},setCanShuffle:t=>{e.canShuffle=t},setShuffle:t=>{e.shuffle=t},setCurrentlyPlayingTrackIndex:t=>{e.currentlyPlayingTrackIndex=t},setQuality:t=>{e.quality=t}})),b=(e,t)=>({type:c.RX.Unloaded,meta:{id:e,albumId:t}});var w=a(66403),I=a(6769)},29765:function(e,t,a){a.d(t,{Tb:function(){return d},yC:function(){return o},nJ:function(){return i},sd:function(){return E},$J:function(){return b},Ez:function(){return V}});var n,r,i,o,s=a(36019);async function l(e){let{secretKey:t,data:a}=e,n=new TextEncoder,r=n.encode(t);return crypto.subtle.importKey("raw",r,{name:"HMAC",hash:{name:"SHA-256"}},!0,["sign","verify"]).then(async e=>{let t=n.encode(a);return crypto.subtle.sign("HMAC",e,t).then(e=>{let t=new Uint8Array(e),a=btoa(String.fromCharCode(...t));return a.slice(0,-1)})})}function c(){return Math.floor(Date.now()/1e3)}var u=a(83993);class d extends u.y{name="DownloadInfoMediaProviderException";constructor(e,{code:t="E_DOWNLOADINFO_MEDIA_PROVIDER",...a}={}){super(e,{code:t,...a}),Object.setPrototypeOf(this,d.prototype)}}let y={lossless:[{codec:s.V9.FLAC,bitrateInKbps:0}],hq:[{codec:s.V9.MP3,bitrateInKbps:320}],nq:[{codec:s.V9.AAC,bitrateInKbps:128},{codec:s.V9.MP3,bitrateInKbps:192}],lq:[{codec:s.V9.AAC,bitrateInKbps:128},{codec:s.V9.MP3,bitrateInKbps:192}],preview:[{codec:s.V9.MP3,bitrateInKbps:128}]};class m{secretKey;resource;mediaConfigController;constructor(e){let{httpClient:t,resourceConfig:a,secretKey:n,mediaConfigController:r}=e;this.resource=new s.HZ(t,{params:a.params,gateway:a.gateway,overembed:a.overembed,externalDomain:a.externalDomain,retryPolicyConfig:a.retryPolicyConfig,timeouts:a.timeouts}),this.mediaConfigController=r,this.secretKey=n}getMediaSource(e){return new Promise((t,a)=>{let{entity:{data:{meta:{id:n}}}}=e,r=c();l({secretKey:this.secretKey,data:`${r}${n}`}).then(e=>{this.resource.getStorageData({trackId:String(n),sign:e,tsInSeconds:r,canUseStreaming:!1,direct:!1,requireMp3Link:!1,isAliceRequester:!1,preview:this.mediaConfigController.qualityConfig.preview.value}).then(e=>{let r=function(e,t){if(t.preview.value&&e[0])return e[0];let a=e.find(e=>y.lossless.find(t=>e.codec===t.codec)),n=e.find(e=>y.hq.find(t=>e.codec===t.codec&&e.bitrateInKbps===t.bitrateInKbps)),r=e.find(e=>y.nq.find(t=>e.codec===t.codec&&e.bitrateInKbps===t.bitrateInKbps));return t.lossless.value&&a?a:t.hq.value&&n?n:(t.lq.value||t.nq.value)&&r?r:null}(e,this.mediaConfigController.qualityConfig);null!==r?this.resource.getSrcData({storageUrl:r.downloadInfoUrl}).then(e=>{try{let a=function(e){let{srcData:t,secretKey:a,trackId:n}=e,r=function(e,t){let a,n,r,i,o,s,l,c,u;let d=String.fromCharCode;function y(e,t){return e<<t|e>>>32-t}function m(e,t){let a,n,r,i,o;return(r=2147483648&e,i=2147483648&t,a=1073741824&e,n=1073741824&t,o=(1073741823&e)+(1073741823&t),a&n)?2147483648^o^r^i:a|n?1073741824&o?3221225472^o^r^i:1073741824^o^r^i:o^r^i}function h(e,t,a,n,r,i,o){return e=m(e,m(m(t&a|~t&n,r),o)),m(y(e,i),t)}function v(e,t,a,n,r,i,o){return e=m(e,m(m(t&n|a&~n,r),o)),m(y(e,i),t)}function f(e,t,a,n,r,i,o){return e=m(e,m(m(t^a^n,r),o)),m(y(e,i),t)}function g(e,t,a,n,r,i,o){return e=m(e,m(m(a^(t|~n),r),o)),m(y(e,i),t)}function p(e){let t="",a="",n;for(n=0;n<=3;n++)t+=(a=`0${(e>>>8*n&255).toString(16)}`).substr(a.length-2,2);return t}let E=[];for(a=0,E=function(e){let t;let a=e.length,n=a+8,r=((n-n%64)/64+1)*16,i=Array(r-1),o=0,s=0;for(;s<a;)t=(s-s%4)/4,o=s%4*8,i[t]=i[t]|e.charCodeAt(s)<<o,s++;return t=(s-s%4)/4,o=s%4*8,i[t]=i[t]|128<<o,i[r-2]=a<<3,i[r-1]=a>>>29,i}(e=function(e){e=t+e.replace(/\r\n/g,"\n");let a="";for(let t=0;t<e.length;t++){let n=e.charCodeAt(t);n<128?a+=d(n):n>127&&n<2048?a+=d(n>>6|192)+d(63&n|128):a+=d(n>>12|224)+d(n>>6&63|128)+d(63&n|128)}return a}(e)),s=1732584193,l=4023233417,c=2562383102,u=271733878;a<E.length;a+=16)n=s,r=l,i=c,o=u,s=h(s,l,c,u,E[a+0],7,3614090360),u=h(u,s,l,c,E[a+1],12,3905402710),c=h(c,u,s,l,E[a+2],17,606105819),l=h(l,c,u,s,E[a+3],22,3250441966),s=h(s,l,c,u,E[a+4],7,4118548399),u=h(u,s,l,c,E[a+5],12,1200080426),c=h(c,u,s,l,E[a+6],17,2821735955),l=h(l,c,u,s,E[a+7],22,4249261313),s=h(s,l,c,u,E[a+8],7,1770035416),u=h(u,s,l,c,E[a+9],12,2336552879),c=h(c,u,s,l,E[a+10],17,4294925233),l=h(l,c,u,s,E[a+11],22,2304563134),s=h(s,l,c,u,E[a+12],7,1804603682),u=h(u,s,l,c,E[a+13],12,4254626195),c=h(c,u,s,l,E[a+14],17,2792965006),l=h(l,c,u,s,E[a+15],22,1236535329),s=v(s,l,c,u,E[a+1],5,4129170786),u=v(u,s,l,c,E[a+6],9,3225465664),c=v(c,u,s,l,E[a+11],14,643717713),l=v(l,c,u,s,E[a+0],20,3921069994),s=v(s,l,c,u,E[a+5],5,3593408605),u=v(u,s,l,c,E[a+10],9,38016083),c=v(c,u,s,l,E[a+15],14,3634488961),l=v(l,c,u,s,E[a+4],20,3889429448),s=v(s,l,c,u,E[a+9],5,568446438),u=v(u,s,l,c,E[a+14],9,3275163606),c=v(c,u,s,l,E[a+3],14,4107603335),l=v(l,c,u,s,E[a+8],20,1163531501),s=v(s,l,c,u,E[a+13],5,2850285829),u=v(u,s,l,c,E[a+2],9,4243563512),c=v(c,u,s,l,E[a+7],14,1735328473),l=v(l,c,u,s,E[a+12],20,2368359562),s=f(s,l,c,u,E[a+5],4,4294588738),u=f(u,s,l,c,E[a+8],11,2272392833),c=f(c,u,s,l,E[a+11],16,1839030562),l=f(l,c,u,s,E[a+14],23,4259657740),s=f(s,l,c,u,E[a+1],4,2763975236),u=f(u,s,l,c,E[a+4],11,1272893353),c=f(c,u,s,l,E[a+7],16,4139469664),l=f(l,c,u,s,E[a+10],23,3200236656),s=f(s,l,c,u,E[a+13],4,681279174),u=f(u,s,l,c,E[a+0],11,3936430074),c=f(c,u,s,l,E[a+3],16,3572445317),l=f(l,c,u,s,E[a+6],23,76029189),s=f(s,l,c,u,E[a+9],4,3654602809),u=f(u,s,l,c,E[a+12],11,3873151461),c=f(c,u,s,l,E[a+15],16,530742520),l=f(l,c,u,s,E[a+2],23,3299628645),s=g(s,l,c,u,E[a+0],6,4096336452),u=g(u,s,l,c,E[a+7],10,1126891415),c=g(c,u,s,l,E[a+14],15,2878612391),l=g(l,c,u,s,E[a+5],21,4237533241),s=g(s,l,c,u,E[a+12],6,1700485571),u=g(u,s,l,c,E[a+3],10,2399980690),c=g(c,u,s,l,E[a+10],15,4293915773),l=g(l,c,u,s,E[a+1],21,2240044497),s=g(s,l,c,u,E[a+8],6,1873313359),u=g(u,s,l,c,E[a+15],10,4264355552),c=g(c,u,s,l,E[a+6],15,2734768916),l=g(l,c,u,s,E[a+13],21,1309151649),s=g(s,l,c,u,E[a+4],6,4149444226),u=g(u,s,l,c,E[a+11],10,3174756917),c=g(c,u,s,l,E[a+2],15,718787259),l=g(l,c,u,s,E[a+9],21,3951481745),s=m(s,n),l=m(l,r),c=m(c,i),u=m(u,o);let C=p(s)+p(l)+p(c)+p(u);return C.toLowerCase()}(t.path.substr(1)+t.s,a),i=`/get-mp3/${r}/${t.ts}${t.path}?track-id=${n}&play=false`;return`https://${t.host}${i}`}({trackId:n,srcData:e,secretKey:this.secretKey});t(a)}catch(t){let e=t;t instanceof Error&&(e={name:t.name,message:t.message,stack:t.stack,cause:t.cause}),a(new d("Failed to create src link",{code:"E_CREATE_SRC_LINK",cause:e,data:{trackId:n}}))}}).catch(e=>{a(new d("Failed to get src data",{code:"E_GET_SRC_DATA",cause:e,data:{trackId:n}}))}):a(new d("No storage url for entity",{code:"E_NO_STORAGE_URL"}))}).catch(e=>{a(new d("Failed to get storage data",{code:"E_GET_STORAGE_DATA",cause:e,data:{trackId:n}}))})}).catch(e=>{let t=e;e instanceof Error&&(t={name:e.name,message:e.message,stack:e.stack,cause:e.cause}),a(new d("Failed to create sign",{code:"E_CREATE_SIGN",cause:t,data:{trackId:n}}))})})}}(n=i||(i={})).HQ_PLUS="hqPlus",n.HQ="hq",n.NQ="nq",n.LQ="lq",n.PREVIEW="preview";class h extends u.y{name="GetFileInfoMediaProviderException";constructor(e,{code:t="E_GET_FILE_INFO_MEDIA_PROVIDER",...a}={}){super(e,{code:t,...a}),Object.setPrototypeOf(this,h.prototype)}}class v{secretKey;resource;mediaConfigController;transport;constructor(e){let{httpClient:t,resourceConfig:a,secretKey:n,mediaConfigController:r,transport:i}=e;this.resource=new s.dF(t,{params:a.params,gateway:a.gateway}),this.secretKey=n,this.mediaConfigController=r,this.transport=i}getMediaSource(e){let t;let a=c(),n=function(e){let t=s.nJ.NQ;switch(e){case i.HQ_PLUS:t=s.nJ.LOSSLESS;break;case i.HQ:t=s.nJ.HQ;break;case i.NQ:case i.LQ:t=s.nJ.NQ;break;case i.PREVIEW:t=s.nJ.PREVIEW}return t}(this.mediaConfigController.quality.value),{concatedCodecs:r,arrayOfCodecs:o}=(t={concatedCodecs:`${s.V9.AAC}${s.V9.MP3}`,arrayOfCodecs:[s.V9.AAC,s.V9.MP3]},n===s.nJ.LOSSLESS&&(t={concatedCodecs:`${s.V9.FLAC}${s.V9.AAC}${s.V9.MP3}`,arrayOfCodecs:[s.V9.FLAC,s.V9.AAC,s.V9.MP3]}),t),u=`${a}${e.entity.data.meta.id}${n}${r}${this.transport}`;return new Promise((t,i)=>{l({data:u,secretKey:this.secretKey}).then(s=>this.resource.getFileInfo({tsInSeconds:a,trackId:e.entity.data.meta.id,quality:n,codecs:o,transports:[this.transport],sign:s}).then(e=>{if(!e.downloadInfo.urls?.[0])throw Error("An empty array of URLs has been received");t(e.downloadInfo.urls[0])}).catch(t=>{let a=t;t instanceof Error&&(a={name:t.name,message:t.message,stack:t.stack,cause:t.cause}),i(new h("An empty array of URLs has been received",{code:"E_EMPTY_URLS",cause:a,data:{trackId:e.entity.data.meta.id,quality:n,codecs:r}}))})).catch(t=>{let a=t;t instanceof Error&&(a={name:t.name,message:t.message,stack:t.stack,cause:t.cause}),i(new h("Failed to create sign",{code:"E_CREATE_SIGN",cause:a,data:{trackId:e.entity.data.meta.id,quality:n,codecs:r}}))})})}}var f=a(84140);class g extends u.y{name="YaMusicEntityProviderException";constructor(e,{code:t="E_YAMUSIC_ENTITY_PROVIDER",...a}={}){super(e,{code:t,...a}),Object.setPrototypeOf(this,g.prototype)}}var p=a(71440);class E{resource;constructor(e){let{httpClient:t,config:a}=e;this.resource=new s.HZ(t,{params:a.params,gateway:a.gateway,retryPolicyConfig:a.retryPolicyConfig,timeouts:a.timeouts})}async loadEntities(e){let t=e.map(({context:e,entity:t})=>(0,p.m3)(e)?`${t.data.meta.id}:${e.data.meta.id}`:(0,p.KT)(e)&&"albumId"in t.data.meta&&t.data.meta.albumId?`${t.data.meta.id}:${t.data.meta.albumId}`:t.data.meta.id);return this.resource.getTracksMeta({trackIds:t,withProgress:!0}).then(e=>{let t=[];for(let a of e)t.push({type:f.A4.Unknown,meta:a});return t}).catch(e=>{throw new g("Failed to get entities meta",{cause:e})})}}var C=a(87025);class b{qualityConfig={lossless:new C.w(!1),hq:new C.w(!0),nq:new C.w(!0),lq:new C.w(!0),preview:new C.w(!0)};quality=new C.w(i.HQ);constructor(e){this.setQuality(e)}setQuality(e){switch(e){case i.HQ_PLUS:this.qualityConfig.lossless.value=!0,this.qualityConfig.hq.value=!0,this.qualityConfig.nq.value=!0,this.qualityConfig.lq.value=!0,this.qualityConfig.preview.value=!1,this.quality.value=i.HQ_PLUS;break;case i.HQ:this.qualityConfig.lossless.value=!1,this.qualityConfig.hq.value=!0,this.qualityConfig.nq.value=!0,this.qualityConfig.lq.value=!0,this.qualityConfig.preview.value=!1,this.quality.value=i.HQ;break;case i.NQ:case i.LQ:this.qualityConfig.lossless.value=!1,this.qualityConfig.hq.value=!1,this.qualityConfig.nq.value=!0,this.qualityConfig.lq.value=!0,this.qualityConfig.preview.value=!1,this.quality.value=i.NQ;break;case i.PREVIEW:this.qualityConfig.lossless.value=!1,this.qualityConfig.hq.value=!1,this.qualityConfig.nq.value=!1,this.qualityConfig.lq.value=!1,this.qualityConfig.preview.value=!0,this.quality.value=i.PREVIEW}}}(r=o||(o={})).DOWNLOAD_INFO_PROVIDER="downloadInfoProvider",r.GET_FILE_INFO_PROVIDER="getFileInfoProvider";class w extends u.y{name="GenerativeMediaProviderException";constructor(e,{code:t="E_GENERATIVE_MEDIA_PROVIDER",...a}={}){super(e,{code:t,...a}),Object.setPrototypeOf(this,w.prototype)}}class I{async getMediaSource(e){return(0,f.OX)(e.entity)?this.getGenerativeSrc(e.entity.data):new Promise((e,t)=>{t(new w("Provided entity is not generative entity",{code:"E_NOT_GENERATIVE_NETITY"}))})}async getGenerativeSrc(e){return new Promise((t,a)=>{e.meta.stream?.url?t(e.meta.stream.url):a(new w("Failed to create generative src link",{code:"E_CREATE_GENERATIVE_SRC_LINK"}))})}}class V{params;mediaProvider;generaiveMediaProvider;constructor(e){switch(this.params=e,e.type){case o.DOWNLOAD_INFO_PROVIDER:this.mediaProvider=new m(e.providerParams);break;case o.GET_FILE_INFO_PROVIDER:this.mediaProvider=new v(e.providerParams)}this.generaiveMediaProvider=new I}async getMediaSource(e){return(0,f.OX)(e.entity)?this.generaiveMediaProvider.getMediaSource(e):this.mediaProvider.getMediaSource(e)}}}}]);